from api_client_details import threatfox_post

def search_ioc_by_malware():
    print("# Search IOCs associated with a certain malware family #")
    family = input("Enter malware family name: ").strip()
    if not family:
        print("❗❗: Malware family name is required to search!")
        return

    try:
        limit_results = int(input("How many results would you like? use range 1-1000: "))
        if not (1 <= limit_results <= 1000):
            print("❗❗: Please use a range between 1 to 1000!")
            return
    except ValueError:    
        print("❗❗: Please enter a valid number!")
        return

    query_params = {"query": "malwareinfo", "malware": family, "limit": limit_results}

    res = threatfox_post(query_params)

    if not res or "data" not in res:
        print("OOPS!🙈 We could not find any data for your search!")
        return

    if not isinstance(res["data"], list):
        print("\n⚠ ⚠ : Unexpected response format from ThreatFox:")
        print(res["data"])
        return

    print(f"🧪 Found {len(res['data'])} IOCs for malware family: {family}\n")

    for ioc in res["data"]:
        print(f"IOC: {ioc.get('ioc')} | Type: {ioc.get('ioc_type')}")
        print(f"Threat type of IOC: {ioc.get('threat_type')} - {ioc.get('threat_type_desc')}")
        print(f"Malware name in IOC: {ioc.get('malware_printable')}")
        print(f"Level of malice carried: {ioc.get('confidence_level')}\n")
